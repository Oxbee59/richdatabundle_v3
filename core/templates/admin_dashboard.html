{% extends "base.html" %}
{% block content %}
<div class="page" style="max-width:1000px;margin:auto; padding:15px;">

    <h2 style="color:#6a0dad; margin-bottom:20px;">Admin Dashboard</h2>

    <!-- METRICS CARDS -->
    <div class="metrics-grid">

        <!-- Total Agents -->
        <a href="{% url 'admin_agents' %}" class="metric-card primary clickable">
            <h4>Total Agents</h4>
            <p>{{ total_agents }}</p>
        </a>

        <!-- Total Wallet Funds -->
        <a href="{% url 'admin_wallets' %}" class="metric-card clickable">
            <h4>Total Wallet Funds</h4>
            <p>GHS {{ total_wallets }}</p>
        </a>

        <!-- Orders Today -->
        <a href="{% url 'admin_orders_today' %}" class="metric-card clickable">
            <h4>Orders Today</h4>
            <p>{{ total_orders_today }}</p>
        </a>

    </div>

    <!-- ACTION BUTTONS -->
    <div class="actions">
        <a href="{% url 'admin_add_bundle' %}" class="btn-primary">âž• Add Bundle</a>
        <a href="{% url 'admin_update_agent_wallet' %}" class="btn-primary">ðŸ’° Fund Agent</a>
        <a href="{% url 'admin_set_registration_fee' %}" class="btn-primary">ðŸ“‹ Set Registration Fee</a>
    </div>

    <!-- RECENT CONTACT MESSAGES -->
    <h3 class="section-title">Recent Contact Messages</h3>
    <div class="table-container">
        <table>
            <tr>
                <th>From</th>
                <th>Subject</th>
                <th>Message</th>
                <th>Date</th>
            </tr>
            {% for msg in contact_messages %}
            <tr>
                <td>
                    {% if msg.user %}
                        {{ msg.user.username }}
                    {% else %}
                        {{ msg.email }}
                    {% endif %}
                </td>
                <td>{{ msg.subject }}</td>
                <td>{{ msg.message|truncatewords:15 }}</td>
                <td>{{ msg.created_at|date:"M d, Y H:i" }}</td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="4" style="text-align:center;">No messages yet.</td>
            </tr>
            {% endfor %}
        </table>
    </div>

    <!-- BUNDLES SECTION -->
    <h3 class="section-title" style="margin-top:30px;">Current Bundles</h3>
    <div class="bundle-grid">
        {% for b in bundles %}
        <a href="#" class="bundle-card"> <!-- replace # with bundle detail url if exists -->
            <strong>{{ b.network }} â€¢ {{ b.name }}</strong><br>
            GHS {{ b.price }} <br>
            {% if b.send_via_api %}
                <small style="color:#6a0dad;">API</small>
            {% else %}
                Admin
            {% endif %}
        </a>
        {% empty %}
        <p>No bundles yet.</p>
        {% endfor %}
    </div>

</div>

<!-- STYLES -->
<style>
.metrics-grid {
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(150px,1fr));
    gap:15px;
    margin-bottom:25px;
}
.metric-card {
    display:block;
    background:white;
    padding:20px;
    border-radius:12px;
    box-shadow:0 3px 10px rgba(0,0,0,0.1);
    text-decoration:none;
    color: inherit;
    transition:0.2s ease;
}
.metric-card.primary { background:#6a0dad; color:white; }
.metric-card:hover { transform:scale(1.05); box-shadow:0 4px 12px rgba(0,0,0,0.15); }
.metric-card p { font-size:22px; font-weight:bold; margin-top:5px; }

.actions {
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(160px,1fr));
    gap:15px;
    margin-bottom:25px;
}
.btn-primary {
    display:block;
    text-align:center;
    background:#6a0dad;
    color:white;
    padding:12px 18px;
    border:none;
    border-radius:8px;
    font-weight:500;
    cursor:pointer;
    text-decoration:none;
}
.btn-primary:hover { background:#501393; transform:scale(1.04); }

.table-container { overflow-x:auto; margin-bottom:25px; }
table { width:100%; border-collapse:collapse; background:white; border-radius:10px; overflow:hidden; box-shadow:0 2px 10px rgba(0,0,0,0.08);}
th { background:#f0e8ff; padding:12px; text-align:left; color:#6a0dad; }
td { padding:12px; border-bottom:1px solid #eee; }

.bundle-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(140px,1fr)); gap:12px; }
.bundle-card {
    display:block;
    background:#fafafa;
    border-radius:10px;
    padding:10px;
    text-align:center;
    box-shadow:0 1px 6px rgba(0,0,0,0.08);
    text-decoration:none;
    color:inherit;
    transition:0.2s ease;
}
.bundle-card:hover { transform:scale(1.03); box-shadow:0 2px 8px rgba(0,0,0,0.12); }

.section-title { color:#6a0dad; font-weight:700; margin-bottom:10px; }

@media(max-width:600px){
    .metric-card p { font-size:18px; }
    .btn-primary { padding:10px; }
    th, td { font-size:13px; }
}
</style>

{% endblock %}
