{% extends "base.html" %}
{% load static %}
{% block content %}

<style>
.page-card { 
    max-width:1000px; 
    margin:auto; 
    background:white; 
    padding:25px; 
    border-radius:15px; 
    box-shadow:0 3px 10px rgba(0,0,0,0.1);
}
.agents-table {
    width:100%;
    border-collapse:collapse;
    margin-top:20px;
}
.agents-table th, .agents-table td {
    border:1px solid #ddd;
    padding:10px;
    text-align:left;
}
.agents-table th {
    background:#6a0dad;
    color:white;
}
.btn-primary {
    background:#6a0dad; 
    color:white; 
    padding:6px 12px; 
    border:none; 
    border-radius:6px; 
    cursor:pointer; 
    font-weight:600;
}
.btn-primary:hover { 
    background:#501393; 
}
.btn-danger {
    background:#dc3545; 
    color:white; 
    padding:6px 12px; 
    border:none; 
    border-radius:6px; 
    cursor:pointer; 
    font-weight:600;
}
.btn-danger:hover { 
    background:#a71d2a; 
}
.alert-success {
    padding:12px;
    margin-bottom:10px;
    border-radius:8px;
    color:white;
    background:#28a745;
}
.alert-error {
    padding:12px;
    margin-bottom:10px;
    border-radius:8px;
    color:white;
    background:#dc3545;
}
</style>

<div class="page-card">
    <h2 style="text-align:center;color:#6a0dad;">Agents Management</h2>

    <!-- MESSAGE ALERTS -->
    {% if messages %}
        {% for msg in messages %}
            {% if msg.tags == 'success' %}
                <div class="alert-success">{{ msg }}</div>
            {% else %}
                <div class="alert-error">{{ msg }}</div>
            {% endif %}
        {% endfor %}
    {% endif %}

    <table class="agents-table">
        <thead>
            <tr>
                <th>#</th>
                <th>Username</th>
                <th>Email</th>
                <th>Wallet (GHS)</th>
                <th>Total Sales</th>
                <th>Sales Volume</th>
                <th>API Keys</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for a in agent_data %}
            <tr>
                <td>{{ forloop.counter }}</td>
                <td>{{ a.user.username }}</td>
                <td>{{ a.user.email }}</td>
                <td>{{ a.wallet }}</td>
                <td>{{ a.sales }}</td>
                <td>{{ a.volume }}</td>
                <td>
                    {% if a.agent %}
                        PUB: {{ a.agent.public_key|default:"-" }}<br>
                        SEC: {{ a.agent.secret_key|default:"-" }}
                    {% else %}
                        -
                    {% endif %}
                </td>
                <td>
                    {% if not a.user.is_staff %}
                        <a href="{% url 'admin_make_staff' a.user.id %}">
                            <button class="btn-primary">Make Staff</button>
                        </a>
                    {% else %}
                        <span style="color:green;font-weight:bold;">Staff</span>
                    {% endif %}
                    <a href="{% url 'admin_delete_agent' a.user.id %}" onclick="return confirm('Are you sure?');">
                        <button class="btn-danger">Delete</button>
                    </a>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="8" style="text-align:center;">No agents found.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% endblock %}
